<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SCG HEIM Dashboard - V4.1 Dept New</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Public Sans', 'sans-serif'] },
                    colors: { 
                        brand: { red: '#ED1C24', dark: '#0F172A', light: '#F1F5F9' } 
                    },
                    boxShadow: {
                        'soft': '0 4px 20px -2px rgba(0, 0, 0, 0.05)',
                        'glow': '0 0 15px rgba(237, 28, 36, 0.3)'
                    },
                    animation: {
                        'fade-in-up': 'fadeInUp 0.5s ease-out forwards',
                        'pulse-slow': 'pulse 3s infinite',
                    },
                    keyframes: {
                        fadeInUp: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>
    <!-- Fonts & Libraries -->
    <link href="https://fonts.googleapis.com/css2?family=Public+Sans:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        body { background-color: #F8FAFC; color: #1E293B; overflow: hidden; }
        
        /* Custom Scrollbar */
        .custom-scrollbar::-webkit-scrollbar { width: 6px; height: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #CBD5E1; border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #94A3B8; }

        /* Navigation Tabs */
        .nav-item {
            @apply flex items-center justify-center w-10 h-10 rounded-xl transition-all duration-300 text-slate-400 hover:text-slate-600 hover:bg-white/50 relative cursor-pointer;
        }
        .nav-item.active {
            @apply bg-white text-red-600 shadow-soft shadow-red-500/10 transform scale-105;
        }
        .nav-item:hover::after {
            content: attr(data-tooltip);
            @apply absolute -bottom-8 left-1/2 -translate-x-1/2 bg-slate-800 text-white text-[10px] py-1 px-2 rounded opacity-100 whitespace-nowrap pointer-events-none z-50;
        }

        /* Glassmorphism */
        .glass-panel {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.6);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.03);
        }

        /* Table */
        .premium-table th { @apply px-4 py-3 text-left text-[11px] font-bold text-slate-400 uppercase tracking-wider bg-slate-50/80 sticky top-0 backdrop-blur-sm z-10 border-b border-slate-100; }
        .premium-table td { @apply px-4 py-3 text-xs text-slate-600 border-b border-slate-50 transition-colors; }
        .premium-table tr:hover td { @apply bg-red-50/30; }
        
        /* OptGroup Styling support */
        optgroup { font-weight: 800; color: #1e293b; background-color: #f1f5f9; }
        option { font-weight: 400; padding: 4px; background-color: #ffffff; }
    </style>
</head>
<body class="flex flex-col h-screen">

    <!-- Top Bar -->
    <header class="bg-white/80 backdrop-blur-md border-b border-slate-200 z-50 flex-none h-16">
        <div class="max-w-7xl mx-auto px-6 h-full flex items-center justify-between">
            <!-- Brand -->
            <div class="flex items-center gap-4 cursor-pointer group" onclick="fireConfetti()">
                <div class="w-10 h-10 bg-gradient-to-br from-red-600 to-red-500 rounded-2xl flex items-center justify-center text-white shadow-glow group-hover:scale-110 transition-transform duration-300">
                    <i data-lucide="zap" class="w-5 h-5 fill-current"></i>
                </div>
                <div>
                    <h1 class="text-xl font-black tracking-tight text-slate-800 italic uppercase">HEIM OPS</h1>
                    <div class="flex items-center gap-2">
                        <span class="px-1.5 py-0.5 bg-slate-100 rounded text-[9px] font-bold text-slate-500 uppercase tracking-wider">V4.1 Dept New</span>
                    </div>
                </div>
            </div>

            <!-- Navigation & Actions -->
            <div class="flex items-center gap-6">
                <!-- Tabs -->
                <div class="bg-slate-100/50 p-1 rounded-2xl flex gap-1">
                    <button id="tab-overview" onclick="switchTab('overview')" class="nav-item active" data-tooltip="Overview"><i data-lucide="layout-dashboard" class="w-5 h-5"></i></button>
                    <button id="tab-detail" onclick="switchTab('detail')" class="nav-item" data-tooltip="Records Table"><i data-lucide="table-2" class="w-5 h-5"></i></button>
                    <button id="tab-dept" onclick="switchTab('dept')" class="nav-item" data-tooltip="Dept Statistics"><i data-lucide="building-2" class="w-5 h-5"></i></button>
                    <button id="tab-dept-chart" onclick="switchTab('dept-chart')" class="nav-item" data-tooltip="Dept Comparison"><i data-lucide="bar-chart-big" class="w-5 h-5"></i></button>
                </div>

                <div class="w-px h-8 bg-slate-200"></div>

                <!-- Actions -->
                <div class="flex items-center gap-2">
                    <button onclick="captureScreen()" class="w-9 h-9 rounded-xl border border-slate-200 text-slate-400 hover:text-red-500 hover:border-red-200 hover:bg-red-50 flex items-center justify-center transition-all" title="Screenshot">
                        <i data-lucide="camera" class="w-4 h-4"></i>
                    </button>
                    <button onclick="toggleImportModal()" class="flex items-center gap-2 px-4 py-2 bg-slate-900 text-white rounded-xl text-xs font-bold hover:bg-slate-800 transition-all shadow-lg shadow-slate-900/20 active:scale-95">
                        <i data-lucide="database" class="w-3.5 h-3.5"></i> <span>Data Hub</span>
                    </button>
                    <button onclick="clearData()" class="w-9 h-9 rounded-xl text-slate-300 hover:text-red-500 hover:bg-red-50 flex items-center justify-center transition-all" title="Reset">
                        <i data-lucide="trash-2" class="w-4 h-4"></i>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Content Area -->
    <main id="capture-area" class="flex-1 max-w-7xl mx-auto w-full p-6 flex flex-col gap-6 overflow-hidden">
        
        <!-- Smart Filters (Glass Panel) -->
        <section class="glass-panel rounded-3xl p-4 flex items-center gap-4 flex-none z-40">
            <div class="flex items-center gap-3 flex-1">
                <!-- Year -->
                <div class="relative w-28 group">
                    <div class="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 group-hover:text-red-500 transition-colors"><i data-lucide="calendar" class="w-4 h-4"></i></div>
                    <select id="filter-year" onchange="runAnalysis()" class="w-full bg-white border border-slate-200 rounded-xl py-2.5 pl-10 pr-4 text-xs font-bold text-slate-700 outline-none focus:ring-2 focus:ring-red-500/10 focus:border-red-500 cursor-pointer shadow-sm">
                        <option value="2026" selected>2026</option>
                        <option value="2025">2025</option>
                        <option value="2024">2024</option>
                    </select>
                </div>
                <!-- Month -->
                <div class="relative w-36 group">
                    <div class="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 group-hover:text-red-500 transition-colors"><i data-lucide="clock" class="w-4 h-4"></i></div>
                    <select id="filter-month" onchange="runAnalysis()" class="w-full bg-white border border-slate-200 rounded-xl py-2.5 pl-10 pr-4 text-xs font-bold text-slate-700 outline-none focus:ring-2 focus:ring-red-500/10 focus:border-red-500 cursor-pointer shadow-sm">
                        <option value="ALL" selected>All Months</option>
                        <option value="01">January</option><option value="02">February</option><option value="03">March</option><option value="04">April</option>
                        <option value="05">May</option><option value="06">June</option><option value="07">July</option><option value="08">August</option>
                        <option value="09">September</option><option value="10">October</option><option value="11">November</option><option value="12">December</option>
                    </select>
                </div>
                <!-- Department -->
                <div class="relative flex-1 max-w-xl group">
                    <div class="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 group-hover:text-red-500 transition-colors"><i data-lucide="building" class="w-4 h-4"></i></div>
                    <select id="filter-dept" onchange="runAnalysis()" class="w-full bg-white border border-slate-200 rounded-xl py-2.5 pl-10 pr-8 text-xs font-bold text-slate-700 outline-none focus:ring-2 focus:ring-red-500/10 focus:border-red-500 cursor-pointer shadow-sm">
                        <option value="All">All Departments (New)</option>
                    </select>
                </div>
            </div>
            
            <!-- Search & Reset -->
            <div class="flex items-center gap-2">
                <div class="relative w-64 group">
                    <div class="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 group-hover:text-red-500 transition-colors"><i data-lucide="search" class="w-4 h-4"></i></div>
                    <input id="search-term" oninput="runAnalysis()" type="text" placeholder="Search employee..." class="w-full bg-white border border-slate-200 rounded-xl py-2.5 pl-10 pr-4 text-xs font-bold text-slate-700 outline-none focus:ring-2 focus:ring-red-500/10 focus:border-red-500 shadow-sm placeholder:text-slate-400">
                </div>
                <button onclick="resetFilters()" class="w-10 h-10 flex items-center justify-center bg-white border border-slate-200 text-slate-400 rounded-xl hover:text-red-500 hover:border-red-200 transition-all shadow-sm" title="Reset Filters">
                    <i data-lucide="rotate-ccw" class="w-4 h-4"></i>
                </button>
            </div>
        </section>

        <!-- VIEW: Overview -->
        <div id="content-overview" class="flex-1 flex flex-col gap-6 overflow-hidden animate-fade-in-up">
            <!-- KPI Cards -->
            <div class="grid grid-cols-5 gap-4 flex-none">
                <!-- Card 1 -->
                <div class="bg-white p-5 rounded-3xl shadow-soft border border-slate-100 flex items-center gap-4 kpi-card group">
                    <div class="w-12 h-12 rounded-2xl bg-slate-50 flex items-center justify-center text-slate-400 group-hover:bg-slate-900 group-hover:text-white transition-colors">
                        <i data-lucide="database" class="w-6 h-6"></i>
                    </div>
                    <div>
                        <p class="text-[10px] font-bold text-slate-400 uppercase tracking-wider">Total Records</p>
                        <h3 id="stat-total" class="text-2xl font-black text-slate-800">0</h3>
                    </div>
                </div>
                <!-- Card 2 -->
                <div class="bg-white p-5 rounded-3xl shadow-soft border border-slate-100 flex items-center gap-4 kpi-card group">
                    <div class="w-12 h-12 rounded-2xl bg-emerald-50 flex items-center justify-center text-emerald-500 group-hover:bg-emerald-500 group-hover:text-white transition-colors">
                        <i data-lucide="check-circle-2" class="w-6 h-6"></i>
                    </div>
                    <div>
                        <p class="text-[10px] font-bold text-slate-400 uppercase tracking-wider">Completed</p>
                        <h3 id="stat-active" class="text-2xl font-black text-emerald-600">0</h3>
                    </div>
                </div>
                <!-- Card 3 -->
                <div class="bg-white p-5 rounded-3xl shadow-soft border border-slate-100 flex items-center gap-4 kpi-card group">
                    <div class="w-12 h-12 rounded-2xl bg-blue-50 flex items-center justify-center text-blue-500 group-hover:bg-blue-500 group-hover:text-white transition-colors">
                        <i data-lucide="activity" class="w-6 h-6"></i>
                    </div>
                    <div>
                        <p class="text-[10px] font-bold text-slate-400 uppercase tracking-wider">Avg. / Person</p>
                        <h3 id="stat-avg" class="text-2xl font-black text-blue-600">0.0</h3>
                    </div>
                </div>
                <!-- Card 4 -->
                <div class="bg-white p-5 rounded-3xl shadow-soft border border-slate-100 flex items-center gap-4 kpi-card group">
                    <div class="w-12 h-12 rounded-2xl bg-purple-50 flex items-center justify-center text-purple-500 group-hover:bg-purple-500 group-hover:text-white transition-colors">
                        <i data-lucide="pie-chart" class="w-6 h-6"></i>
                    </div>
                    <div>
                        <p class="text-[10px] font-bold text-slate-400 uppercase tracking-wider">Active Rate</p>
                        <h3 id="stat-rate" class="text-2xl font-black text-purple-600">0%</h3>
                    </div>
                </div>
                <!-- Card 5 -->
                <div class="bg-slate-900 p-5 rounded-3xl shadow-soft border border-slate-800 flex items-center gap-4 kpi-card group relative overflow-hidden">
                    <div class="absolute -right-6 -bottom-6 w-24 h-24 bg-white/5 rounded-full blur-2xl"></div>
                    <div class="w-12 h-12 rounded-2xl bg-white/10 flex items-center justify-center text-red-400 group-hover:scale-110 transition-transform">
                        <i data-lucide="user-x" class="w-6 h-6"></i>
                    </div>
                    <div class="relative z-10">
                        <p class="text-[10px] font-bold text-slate-500 uppercase tracking-wider">Pending</p>
                        <h3 id="stat-inactive" class="text-2xl font-black text-white">0</h3>
                    </div>
                </div>
            </div>

            <div class="flex-1 grid grid-cols-12 gap-6 overflow-hidden">
                <!-- Left Column -->
                <div class="col-span-8 flex flex-col gap-6">
                    <!-- Champions -->
                    <div class="grid grid-cols-2 gap-6 h-[180px] flex-none">
                        <!-- Overall Champion -->
                        <div class="bg-gradient-to-br from-slate-900 to-slate-800 rounded-[2.5rem] p-6 text-white relative overflow-hidden shadow-xl flex flex-col justify-between group border border-slate-700/50">
                            <i data-lucide="crown" class="absolute top-4 right-4 w-24 h-24 text-white/5 group-hover:rotate-12 transition-transform duration-700"></i>
                            <div>
                                <span class="inline-flex items-center gap-1 px-2.5 py-1 rounded-lg bg-yellow-500/20 text-yellow-400 border border-yellow-500/30 text-[10px] font-bold uppercase tracking-wider mb-2">
                                    <i data-lucide="trophy" class="w-3 h-3"></i> Overall Champion
                                </span>
                                <h2 id="winner-name" class="text-3xl font-black italic truncate mt-1 leading-tight tracking-tight">-</h2>
                                <p id="winner-dept" class="text-slate-400 text-xs font-semibold truncate mt-1 opacity-80">-</p>
                            </div>
                            <div class="flex items-center justify-between border-t border-white/10 pt-4">
                                <div>
                                    <p class="text-[9px] text-slate-500 uppercase font-bold">Total Learning</p>
                                    <h3 id="winner-hits" class="text-3xl font-black text-yellow-400 italic">0</h3>
                                </div>
                                <div class="w-10 h-10 rounded-full bg-yellow-500 flex items-center justify-center text-slate-900 shadow-lg shadow-yellow-500/30">
                                    <i data-lucide="star" class="w-5 h-5 fill-current"></i>
                                </div>
                            </div>
                        </div>

                        <!-- Monthly Speed Star -->
                        <div class="bg-white rounded-[2.5rem] p-6 border border-slate-100 shadow-soft relative overflow-hidden flex flex-col justify-between group">
                            <div class="absolute top-0 right-0 w-32 h-32 bg-red-50 rounded-full blur-3xl opacity-50 -mr-10 -mt-10 group-hover:scale-125 transition-transform duration-700"></div>
                            <div class="relative z-10">
                                <span id="early-month-label" class="inline-flex items-center gap-1 px-2.5 py-1 rounded-lg bg-red-50 text-red-600 border border-red-100 text-[10px] font-bold uppercase tracking-wider mb-2">
                                    <i data-lucide="clock" class="w-3 h-3"></i> Speed Star
                                </span>
                                <h2 id="early-name" class="text-3xl font-black italic truncate mt-1 leading-tight tracking-tight text-slate-800">-</h2>
                                <p id="early-time" class="text-red-500 text-xs font-bold truncate mt-1">-</p>
                            </div>
                            <div class="relative z-10 flex items-center justify-between border-t border-slate-50 pt-4">
                                <p class="text-[10px] text-slate-400 font-bold uppercase">First submission of the period</p>
                                <div class="w-10 h-10 rounded-full bg-red-100 flex items-center justify-center text-red-600">
                                    <i data-lucide="zap" class="w-5 h-5 fill-current"></i>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Ranking Chart -->
                    <div class="bg-white p-6 rounded-[2.5rem] shadow-soft border border-slate-100 flex-1 flex flex-col min-h-0 relative">
                        <div class="flex items-center justify-between mb-4 flex-none">
                            <div>
                                <h3 id="chart-title" class="text-sm font-black uppercase tracking-wide text-slate-800">Top Learners Leaderboard</h3>
                                <p class="text-[10px] text-slate-400 font-bold mt-0.5">Top 10 Performers</p>
                            </div>
                            <div class="bg-slate-100 p-1 rounded-xl flex">
                                <button onclick="setChartMode('user')" id="btn-mode-user" class="px-3 py-1.5 rounded-lg text-[10px] font-black uppercase transition-all shadow-sm bg-white text-slate-800">Individual</button>
                                <button onclick="setChartMode('dept')" id="btn-mode-dept" class="px-3 py-1.5 rounded-lg text-[10px] font-black uppercase transition-all text-slate-400 hover:text-slate-600">Dept. View</button>
                            </div>
                        </div>
                        <div class="flex-1 min-h-0 relative">
                            <canvas id="learnerChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Right Column (Pending List) -->
                <div class="col-span-4 bg-white p-6 rounded-[2.5rem] shadow-soft border border-slate-100 flex flex-col overflow-hidden h-full">
                    <div class="flex items-center justify-between mb-4 flex-none">
                        <div>
                            <h3 class="text-sm font-black uppercase tracking-wide text-slate-800 flex items-center gap-2">
                                <span class="w-2 h-2 rounded-full bg-orange-500 animate-pulse"></span> Pending List
                            </h3>
                            <p class="text-[10px] text-slate-400 font-bold mt-0.5">Requires follow-up</p>
                        </div>
                        <button onclick="exportData()" class="w-8 h-8 flex items-center justify-center bg-emerald-50 text-emerald-600 rounded-xl hover:bg-emerald-500 hover:text-white transition-all shadow-sm">
                            <i data-lucide="download" class="w-4 h-4"></i>
                        </button>
                    </div>
                    
                    <div class="bg-orange-50/50 rounded-xl p-3 mb-4 flex items-center justify-between border border-orange-100">
                        <span class="text-[10px] font-bold text-orange-600 uppercase">Remaining</span>
                        <span id="pending-count-label" class="text-xs font-black text-white bg-orange-500 px-2 py-0.5 rounded-lg shadow-sm">0</span>
                    </div>

                    <div id="inactive-list-summary" class="flex-1 overflow-y-auto custom-scrollbar space-y-2 pr-1">
                        <!-- Dynamic Content -->
                    </div>
                </div>
            </div>
        </div>

        <!-- VIEW: Detail Table -->
        <div id="content-detail" class="hidden flex-1 flex flex-col bg-white rounded-[2.5rem] border border-slate-100 shadow-soft overflow-hidden animate-fade-in-up">
             <div class="p-6 border-b border-slate-100 flex items-center justify-between flex-none bg-white/50 backdrop-blur-sm z-20">
                 <div>
                     <h3 class="text-lg font-black uppercase italic text-slate-800 tracking-tight">Learning Records Database</h3>
                     <p class="text-xs text-slate-400 font-bold">Complete history of all learning activities</p>
                 </div>
                 <div class="flex items-center gap-3 bg-slate-50 p-1.5 rounded-xl border border-slate-100">
                     <span id="table-info" class="text-[10px] font-bold text-slate-500 px-2">Loading...</span>
                     <div class="flex gap-1">
                         <button onclick="changePage(-1)" class="w-7 h-7 flex items-center justify-center rounded-lg bg-white border border-slate-200 text-slate-500 hover:text-red-500 hover:border-red-200 transition-all"><i data-lucide="chevron-left" class="w-4 h-4"></i></button>
                         <button onclick="changePage(1)" class="w-7 h-7 flex items-center justify-center rounded-lg bg-white border border-slate-200 text-slate-500 hover:text-red-500 hover:border-red-200 transition-all"><i data-lucide="chevron-right" class="w-4 h-4"></i></button>
                     </div>
                 </div>
             </div>
             <div class="flex-1 overflow-auto custom-scrollbar relative">
                 <table class="w-full premium-table">
                     <thead><tr><th>Date</th><th>Name</th><th>Department (New)</th><th>Topic</th></tr></thead>
                     <tbody id="records-table-body"></tbody>
                 </table>
             </div>
        </div>

        <!-- VIEW: Dept Stats Table -->
        <div id="content-dept" class="hidden flex-1 flex flex-col bg-white rounded-[2.5rem] border border-slate-100 shadow-soft overflow-hidden animate-fade-in-up">
            <div class="p-6 border-b border-slate-100 flex-none bg-white/50 backdrop-blur-sm z-20">
                <h3 class="text-lg font-black uppercase italic text-slate-800 tracking-tight">Department Performance</h3>
                <p class="text-xs text-slate-400 font-bold">Detailed breakdown by department</p>
            </div>
            <div class="flex-1 overflow-auto custom-scrollbar p-6">
                <div class="rounded-2xl border border-slate-100 overflow-hidden">
                    <table class="w-full premium-table">
                        <thead class="bg-slate-50"><tr><th>Department Name (New)</th><th class="text-center">Total</th><th class="text-center">Completed</th><th class="text-right">Rate</th></tr></thead>
                        <tbody id="dept-table-body"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- VIEW: Dept Comparison Chart -->
        <div id="content-dept-chart" class="hidden flex-1 flex flex-col bg-white rounded-[2.5rem] border border-slate-100 shadow-soft overflow-hidden animate-fade-in-up">
            <div class="p-6 border-b border-slate-100 flex-none bg-white/50 backdrop-blur-sm z-20">
                <h3 class="text-lg font-black uppercase italic text-slate-800 tracking-tight">Department Comparison</h3>
                <p class="text-xs text-slate-400 font-bold">Visualizing completion rates across organization</p>
            </div>
            <div class="flex-1 p-6 relative">
                <canvas id="deptComparisonChart"></canvas>
            </div>
        </div>
    </main>

    <!-- Import Modal -->
    <div id="import-modal" class="fixed inset-0 z-[100] hidden flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-slate-900/40 backdrop-blur-sm transition-opacity" onclick="toggleImportModal()"></div>
        <div class="bg-white w-full max-w-lg rounded-[2.5rem] shadow-2xl p-8 relative z-10 animate-fade-in-up overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-1.5 bg-gradient-to-r from-red-600 to-orange-500"></div>
            
            <div class="flex items-center justify-between mb-8">
                <div>
                    <h3 class="text-xl font-black text-slate-800 italic uppercase">Data Hub</h3>
                    <p class="text-xs text-slate-400 font-bold mt-1">Import your Excel/CSV files</p>
                </div>
                <button onclick="toggleImportModal()" class="w-8 h-8 rounded-full bg-slate-50 flex items-center justify-center text-slate-400 hover:text-red-500 hover:bg-red-50 transition-all"><i data-lucide="x" class="w-4 h-4"></i></button>
            </div>
            
            <div class="grid grid-cols-2 gap-4 mb-6">
                <div onclick="document.getElementById('file-members').click()" class="bg-slate-50 p-6 rounded-3xl border-2 border-dashed border-slate-200 cursor-pointer hover:border-red-400 hover:bg-red-50/50 transition-all text-center group">
                    <div class="w-12 h-12 bg-white rounded-2xl mx-auto mb-3 flex items-center justify-center shadow-sm text-slate-400 group-hover:text-red-500 group-hover:scale-110 transition-all">
                        <i data-lucide="users" class="w-6 h-6"></i>
                    </div>
                    <p class="font-black text-slate-700 text-xs uppercase group-hover:text-red-600">Import Members</p>
                    <p class="text-[9px] text-slate-400 mt-1">With 'Department New'</p>
                    <input type="file" id="file-members" class="hidden" accept=".xlsx,.xls,.csv" onchange="handleFile(event, 'members')">
                </div>
                <div onclick="document.getElementById('file-records').click()" class="bg-slate-50 p-6 rounded-3xl border-2 border-dashed border-slate-200 cursor-pointer hover:border-red-400 hover:bg-red-50/50 transition-all text-center group">
                    <div class="w-12 h-12 bg-white rounded-2xl mx-auto mb-3 flex items-center justify-center shadow-sm text-slate-400 group-hover:text-red-500 group-hover:scale-110 transition-all">
                        <i data-lucide="file-spreadsheet" class="w-6 h-6"></i>
                    </div>
                    <p class="font-black text-slate-700 text-xs uppercase group-hover:text-red-600">Import Records</p>
                    <p class="text-[9px] text-slate-400 mt-1">Learning History</p>
                    <input type="file" id="file-records" class="hidden" accept=".xlsx,.xls,.csv" onchange="handleFile(event, 'records')">
                </div>
            </div>
            
            <div class="relative py-4"><div class="absolute inset-0 flex items-center"><div class="w-full border-t border-slate-100"></div></div><div class="relative flex justify-center"><span class="bg-white px-3 text-[10px] font-bold text-slate-400 uppercase tracking-widest">Quick Start</span></div></div>
            
            <button onclick="loadDemoData()" class="w-full py-3.5 bg-slate-900 text-white rounded-2xl font-bold text-xs uppercase tracking-wider hover:bg-slate-800 transition-all flex items-center justify-center gap-3 shadow-lg shadow-slate-900/20 active:scale-95 group">
                <i data-lucide="play-circle" class="w-4 h-4 text-emerald-400 group-hover:scale-110 transition-transform"></i> Load Demo Data
            </button>
        </div>
    </div>

    <!-- Logic Script -->
    <script>
        // --- State ---
        let members = [], records = [], pendingList = [], tendencyChart, learnerChart, deptComparisonChart;
        let filteredRecords = [];
        let currentPage = 1;
        const itemsPerPage = 50;
        let currentChartMode = 'user';
        const DEFAULT_DEPT = "SCG HEIM Factory/Product Development and Supply Chain Department";
        const MONTH_NAMES = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];

        window.onload = function() { lucide.createIcons(); loadFromStorage(); runAnalysis(); };

        // --- Navigation ---
        function switchTab(tab) {
            ['overview', 'detail', 'dept', 'dept-chart'].forEach(t => {
                 document.getElementById('content-' + t)?.classList.add('hidden');
                 document.getElementById('tab-' + t)?.classList.remove('active');
            });
            document.getElementById('content-' + tab)?.classList.remove('hidden');
            document.getElementById('tab-' + tab)?.classList.add('active');
            
            if(tab === 'overview') runAnalysis();
            if(tab === 'detail') renderTable();
            if(tab === 'dept') renderDeptStats();
            if(tab === 'dept-chart') renderDeptComparisonChart();
        }

        // --- Data Handling ---
        function toggleImportModal() { document.getElementById('import-modal').classList.toggle('hidden'); }
        function fireConfetti() { confetti({ particleCount: 150, spread: 80, origin: { y: 0.6 }, colors: ['#ED1C24', '#ffffff', '#1e293b'] }); }
        
        function resetFilters() {
            document.getElementById('filter-year').value = "2026";
            document.getElementById('filter-month').value = "ALL";
            document.getElementById('filter-dept').value = "All";
            document.getElementById('search-term').value = "";
            runAnalysis();
        }

        function setChartMode(mode) { 
            currentChartMode = mode; 
            // Update button styles
            document.getElementById('btn-mode-user').className = mode === 'user' ? "px-3 py-1.5 rounded-lg text-[10px] font-black uppercase transition-all shadow-sm bg-white text-slate-800" : "px-3 py-1.5 rounded-lg text-[10px] font-black uppercase transition-all text-slate-400 hover:text-slate-600";
            document.getElementById('btn-mode-dept').className = mode === 'dept' ? "px-3 py-1.5 rounded-lg text-[10px] font-black uppercase transition-all shadow-sm bg-white text-slate-800" : "px-3 py-1.5 rounded-lg text-[10px] font-black uppercase transition-all text-slate-400 hover:text-slate-600";
            document.getElementById('chart-title').innerText = mode === 'user' ? "Top Learners Leaderboard" : "Top Departments Leaderboard";
            runAnalysis(); 
        }

        function animateValue(objId, start, end, duration, suffix = "") {
            const obj = document.getElementById(objId); if(!obj) return;
            let startTimestamp = null;
            const step = (timestamp) => {
                if (!startTimestamp) startTimestamp = timestamp;
                const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                obj.innerText = Math.floor(progress * (end - start) + start).toLocaleString() + suffix;
                if (progress < 1) window.requestAnimationFrame(step); else obj.innerText = end.toLocaleString() + suffix;
            };
            window.requestAnimationFrame(step);
        }

        const normalizeKey = (key) => key.toLowerCase().trim().replace(/[\s\-_]/g, '');

        function handleFile(event, type) {
            const file = event.target.files[0]; if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const workbook = XLSX.read(new Uint8Array(e.target.result), {type: 'array'});
                    const rawData = XLSX.utils.sheet_to_json(workbook.Sheets[workbook.SheetNames[0]]);
                    
                    if(type === 'members') {
                        members = rawData.map(row => {
                            const keys = Object.keys(row);
                            const nameKey = keys.find(k => normalizeKey(k).includes('name') || normalizeKey(k).includes('ชื่อ'));
                            // Priority: Department New > Department > Old Department
                            const deptNewKey = keys.find(k => normalizeKey(k).includes('departmentnew'));
                            const deptKey = keys.find(k => normalizeKey(k) === 'department' || normalizeKey(k) === 'แผนก');
                            const deptOldKey = keys.find(k => normalizeKey(k).includes('olddepartment'));
                            const finalDeptKey = deptNewKey || deptKey || deptOldKey;
                            
                            return { name: String(row[nameKey] || "").trim(), dept: String(row[finalDeptKey] || "").trim() };
                        }).filter(m => m.name && m.name !== "undefined");
                        localStorage.setItem('scg_heim_members_v41', JSON.stringify(members));
                    } else {
                        if (members.length > 0 && members[0].name.startsWith("Employee ")) { members = []; localStorage.removeItem('scg_heim_members_v41'); }
                        records = rawData.map(row => {
                            const keys = Object.keys(row);
                            const nameKey = keys.find(k => normalizeKey(k).includes('name') || normalizeKey(k).includes('ชื่อ'));
                            const deptKey = keys.find(k => normalizeKey(k).includes('dept') || normalizeKey(k).includes('แผนก'));
                            const dateKey = keys.find(k => normalizeKey(k).includes('createddatetime') || normalizeKey(k).includes('time') || normalizeKey(k).includes('date'));
                            const topicKey = keys.find(k => normalizeKey(k).includes('topic') || normalizeKey(k).includes('subject'));
                            
                            let dateStr = row[dateKey], formattedDate = "";
                            if (typeof dateStr === 'number') formattedDate = new Date((dateStr - (25567 + 2)) * 86400 * 1000).toISOString().split('T')[0];
                            else if (dateStr instanceof Date) formattedDate = dateStr.toISOString().split('T')[0];
                            else if (dateStr) formattedDate = String(dateStr).trim().split(' ')[0];
                            
                            let recordName = String(row[nameKey] || "").trim();
                            let recordDept = String(row[deptKey] || "").trim();
                            // SYNC Logic: Use member's Department New if available
                            const matchedMember = members.find(m => m.name === recordName);
                            if (matchedMember) recordDept = matchedMember.dept;

                            return { Name: recordName, Department: recordDept, CreatedDateTime: formattedDate, Topic: String(row[topicKey] || "-") };
                        }).filter(r => r.Name && r.Name !== "undefined");
                        localStorage.setItem('scg_heim_records_v41', JSON.stringify(records));
                    }
                    populateDepts(); runAnalysis(); toggleImportModal(); fireConfetti();
                } catch (err) { console.error(err); alert("Error processing file."); }
            };
            reader.readAsArrayBuffer(file);
        }

        function loadDemoData() {
            const depts = ["Sales > Retail", "Management > HR", "IT > Support", "Production > Line 1", "Logistics"];
            const demoM = []; const demoR = [];
            for (let i = 0; i < 50; i++) demoM.push({ name: `Employee ${i+1}`, dept: depts[Math.floor(Math.random() * depts.length)] });
            const today = new Date();
            for (let i = 0; i < 150; i++) {
                const member = demoM[Math.floor(Math.random() * demoM.length)];
                demoR.push({ Name: member.name, Department: member.dept, CreatedDateTime: new Date(today.getTime() - Math.random() * 63072000000).toISOString().split('T')[0], Topic: "Safety Training" });
            }
            members = demoM; records = demoR;
            localStorage.setItem('scg_heim_members_v41', JSON.stringify(members));
            localStorage.setItem('scg_heim_records_v41', JSON.stringify(records));
            populateDepts(); runAnalysis(); toggleImportModal(); fireConfetti();
        }

        function exportData() {
            if (records.length === 0) { alert("No data to export."); return; }
            const wb = XLSX.utils.book_new();
            const wsPending = XLSX.utils.json_to_sheet(pendingList.map(p => ({ "Name": p.name, "Department (New)": p.dept, "Status": "Pending" })));
            XLSX.utils.book_append_sheet(wb, wsPending, "Pending List");
            const wsRecords = XLSX.utils.json_to_sheet(records);
            XLSX.utils.book_append_sheet(wb, wsRecords, "All Records");
            XLSX.writeFile(wb, `SCG_HEIM_Dashboard_v4.1_${new Date().toISOString().split('T')[0]}.xlsx`);
        }

        function loadFromStorage() {
            try {
                const m = localStorage.getItem('scg_heim_members_v41'), r = localStorage.getItem('scg_heim_records_v41');
                if(m) members = JSON.parse(m); if(r) records = JSON.parse(r);
                populateDepts();
            } catch (e) { localStorage.clear(); }
        }
        function clearData() { if(confirm("Clear all data?")) { localStorage.clear(); location.reload(); } }

        function populateDepts() {
            const allDepts = ["All", ...new Set([...members.map(m => m.dept), ...records.map(r => r.Department)])].filter(d => d).sort();
            const select = document.getElementById('filter-dept');
            if(select) {
                const currentVal = select.value;
                select.innerHTML = ''; 
                const allOpt = document.createElement('option'); allOpt.value = "All"; allOpt.text = "All Departments (New)"; select.appendChild(allOpt);
                const groups = {};
                allDepts.filter(d => d !== "All").forEach(d => {
                    let groupName = "Others";
                    // Split by " > " for grouping, fallback to /
                    if (d.includes(" > ")) groupName = d.split(" > ")[0].trim();
                    else if (d.includes("/")) { const parts = d.split(/\/+/); groupName = parts.length > 1 ? parts[0].trim() : "Others"; }
                    
                    if (!groups[groupName]) groups[groupName] = [];
                    groups[groupName].push(d);
                });
                Object.keys(groups).sort().forEach(groupName => {
                    if(groupName === "Others") return;
                    const grp = document.createElement('optgroup'); grp.label = groupName;
                    groups[groupName].forEach(d => { const opt = document.createElement('option'); opt.value = d; opt.text = d; grp.appendChild(opt); });
                    select.appendChild(grp);
                });
                if (groups["Others"]) {
                    const grp = document.createElement('optgroup'); grp.label = "Other Departments";
                    groups["Others"].forEach(d => { const opt = document.createElement('option'); opt.value = d; opt.text = d; grp.appendChild(opt); });
                    select.appendChild(grp);
                }
                if (currentVal && allDepts.includes(currentVal)) select.value = currentVal;
            }
        }

        async function captureScreen() {
            const captureArea = document.getElementById('capture-area');
            try {
                await new Promise(r => setTimeout(r, 200)); // Wait for render
                const canvas = await html2canvas(captureArea, { scale: 2, backgroundColor: '#F8FAFC', useCORS: true, logging: false });
                const link = document.createElement('a');
                link.download = `HEIM-Platinum-Report.png`;
                link.href = canvas.toDataURL('image/png'); link.click();
            } catch (e) { console.error(e); }
        }

        // --- Analysis Core ---
        function runAnalysis() {
            const year = document.getElementById('filter-year').value;
            const month = document.getElementById('filter-month').value;
            const dept = document.getElementById('filter-dept').value;
            const search = document.getElementById('search-term').value.toLowerCase();

            filteredRecords = records.filter(r => {
                if(!r.CreatedDateTime) return false;
                const dt = String(r.CreatedDateTime);
                return dt.startsWith(year) && (month === 'ALL' || dt.includes(`-${month}-`)) && (dept === 'All' || r.Department === dept) && r.Name.toLowerCase().includes(search);
            });

            // Effective Members Logic
            let effectiveMembers = members;
            if (members.length === 0 && records.length > 0) {
                 const uniqueUsers = new Map();
                 records.forEach(r => { if (!uniqueUsers.has(r.Name)) uniqueUsers.set(r.Name, { name: r.Name, dept: r.Department }); });
                 effectiveMembers = Array.from(uniqueUsers.values());
            }

            const targetPool = effectiveMembers.filter(m => dept === 'All' || m.dept === dept);
            const activeNames = new Set(filteredRecords.map(r => r.Name));
            const activeCount = targetPool.filter(m => activeNames.has(m.name)).length;
            const inactiveCount = Math.max(0, targetPool.length - activeCount);

            // KPIs Animation
            animateValue('stat-total', parseInt(document.getElementById('stat-total').innerText.replace(/,/g,'')) || 0, filteredRecords.length, 800);
            animateValue('stat-active', parseInt(document.getElementById('stat-active').innerText.replace(/,/g,'')) || 0, activeCount, 800);
            document.getElementById('stat-avg').innerText = activeCount > 0 ? (filteredRecords.length / activeCount).toFixed(1) : "0.0";
            const rate = targetPool.length > 0 ? Math.round((activeCount / targetPool.length) * 100) : 0;
            animateValue('stat-rate', parseInt(document.getElementById('stat-rate').innerText.replace('%','')) || 0, rate, 800, "%");
            animateValue('stat-inactive', parseInt(document.getElementById('stat-inactive').innerText.replace(/,/g,'')) || 0, inactiveCount, 800);

            // Champion
            const userCounts = {}; filteredRecords.forEach(r => userCounts[r.Name] = (userCounts[r.Name] || 0) + 1);
            const sortedUsers = Object.entries(userCounts).map(([name, count]) => ({ name, count, dept: (effectiveMembers.find(m => m.name === name) || {}).dept || "N/A" })).sort((a,b) => b.count - a.count);
            const winner = sortedUsers[0];
            document.getElementById('winner-name').innerText = winner ? winner.name : "-";
            document.getElementById('winner-dept').innerText = winner ? winner.dept : "-";
            document.getElementById('winner-hits').innerText = winner ? winner.count : "0";

            // Early Bird
            const first = [...filteredRecords].sort((a,b) => new Date(a.CreatedDateTime) - new Date(b.CreatedDateTime))[0];
            if(first) {
                document.getElementById('early-month-label').innerText = month === 'ALL' ? 'Annual' : MONTH_NAMES[parseInt(month) - 1];
                document.getElementById('early-name').innerText = first.Name;
                document.getElementById('early-time').innerText = first.CreatedDateTime;
            } else { document.getElementById('early-name').innerText = "-"; document.getElementById('early-time').innerText = "-"; }

            // Pending List
            pendingList = targetPool.filter(m => !activeNames.has(m.name));
            let pendingHTML = "";
            if (pendingList.length > 0) {
                 pendingHTML = pendingList.slice(0, 100).map(m => `
                <div class="flex items-center justify-between p-3 bg-white rounded-xl border border-slate-100 hover:border-red-200 transition-all group hover:shadow-sm">
                    <div class="truncate pr-2">
                        <p class="text-[11px] font-bold text-slate-700 truncate group-hover:text-red-600 transition-colors">${m.name}</p>
                        <p class="text-[9px] text-slate-400 font-bold uppercase mt-0.5 truncate">${m.dept}</p>
                    </div>
                    <div class="w-1.5 h-1.5 rounded-full bg-orange-400 flex-none animate-pulse"></div>
                </div>`).join('') + (pendingList.length > 100 ? `<div class="text-center text-[10px] text-slate-400 pt-2 font-bold opacity-60">...and ${pendingList.length - 100} more</div>` : '');
            } else if (targetPool.length > 0) {
                 pendingHTML = '<div class="h-full flex flex-col items-center justify-center text-emerald-500 opacity-80"><i data-lucide="check-circle" class="w-10 h-10 mb-2"></i><span class="text-xs font-bold">All Completed!</span></div>';
            } else { pendingHTML = '<div class="text-center py-10 opacity-40 text-xs font-bold">No Data Available</div>'; }
            document.getElementById('inactive-list-summary').innerHTML = pendingHTML;

            renderCharts(sortedUsers, targetPool, year);
            if(document.getElementById('tab-detail').classList.contains('active')) renderTable();
            if(document.getElementById('tab-dept').classList.contains('active')) renderDeptStats();
            if(document.getElementById('tab-dept-chart').classList.contains('active')) renderDeptComparisonChart();
            lucide.createIcons();
        }

        // --- Renderers ---
        function changePage(delta) {
            const maxPage = Math.ceil(filteredRecords.length / itemsPerPage);
            const newPage = currentPage + delta;
            if (newPage >= 1 && newPage <= maxPage) { currentPage = newPage; renderTable(); }
        }

        function renderTable() {
            const tbody = document.getElementById('records-table-body');
            tbody.innerHTML = '';
            const start = (currentPage - 1) * itemsPerPage;
            const end = start + itemsPerPage;
            const pageData = filteredRecords.slice(start, end);
            document.getElementById('table-info').innerText = `Showing ${filteredRecords.length > 0 ? start + 1 : 0}-${Math.min(end, filteredRecords.length)} of ${filteredRecords.length}`;
            if(pageData.length === 0) { tbody.innerHTML = '<tr><td colspan="4" class="text-center py-12 text-slate-400 text-xs font-bold">No matching records found</td></tr>'; return; }
            pageData.forEach(r => {
                const tr = document.createElement('tr');
                tr.innerHTML = `<td><span class="bg-slate-100 text-slate-600 px-2 py-0.5 rounded text-[10px] font-bold">${r.CreatedDateTime}</span></td><td class="font-bold text-slate-800">${r.Name}</td><td class="truncate max-w-[200px]" title="${r.Department}">${r.Department}</td><td class="truncate max-w-[250px] text-slate-500">${r.Topic}</td>`;
                tbody.appendChild(tr);
            });
        }

        function getDeptStats() {
            let effectiveMembers = members;
            if (members.length === 0 && records.length > 0) {
                 const uniqueUsers = new Map();
                 records.forEach(r => { if (!uniqueUsers.has(r.Name)) uniqueUsers.set(r.Name, { name: r.Name, dept: r.Department }); });
                 effectiveMembers = Array.from(uniqueUsers.values());
            }
            const deptStats = {};
            const allDepts = [...new Set(effectiveMembers.map(m => m.dept))];
            allDepts.forEach(d => deptStats[d] = { total: 0, active: 0 });
            effectiveMembers.forEach(m => { if(deptStats[m.dept]) deptStats[m.dept].total++; });
            
            const year = document.getElementById('filter-year').value;
            const activeInFiltered = new Set();
            records.filter(r => r.CreatedDateTime.startsWith(year)).forEach(r => {
                const user = effectiveMembers.find(m => m.name === r.Name);
                if(user && !activeInFiltered.has(user.name)) { activeInFiltered.add(user.name); if(deptStats[user.dept]) deptStats[user.dept].active++; }
            });
            return Object.entries(deptStats).map(([name, stats]) => ({ name, ...stats, rate: stats.total > 0 ? (stats.active/stats.total*100) : 0 })).sort((a,b) => b.rate - a.rate);
        }

        function renderDeptStats() {
            const tbody = document.getElementById('dept-table-body');
            tbody.innerHTML = '';
            const sortedDepts = getDeptStats();
            sortedDepts.forEach(d => {
                const tr = document.createElement('tr');
                const colorClass = d.rate >= 80 ? 'text-emerald-500' : d.rate < 50 ? 'text-orange-500' : 'text-blue-500';
                tr.innerHTML = `<td class="font-bold text-slate-700" title="${d.name}">${d.name}</td><td class="text-center text-slate-500 font-bold">${d.total}</td><td class="text-center text-emerald-600 font-bold">${d.active}</td><td class="text-right font-black ${colorClass}">${d.rate.toFixed(1)}%</td>`;
                tbody.appendChild(tr);
            });
        }

        function renderCharts(topUsers, targetPool, targetYear) {
            const ctxL = document.getElementById('learnerChart');
            if(learnerChart) learnerChart.destroy();
            let chartData, chartOptions;
            
            if (currentChartMode === 'user') {
                 const top10 = topUsers.slice(0, 10);
                 chartData = { labels: top10.map(u => u.name), datasets: [{ data: top10.map(u => u.count), backgroundColor: '#ED1C24', borderRadius: 6, barThickness: 12, hoverBackgroundColor: '#b91c1c' }] };
                 chartOptions = { indexAxis: 'y', responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { x: { display: false }, y: { ticks: { font: { size: 10, weight: 'bold' }, color: '#475569' }, grid: { display: false } } } };
            } else {
                const sortedDepts = getDeptStats().slice(0, 8);
                chartData = { labels: sortedDepts.map(d => d.name.length > 20 ? d.name.substring(0,20)+'...' : d.name), datasets: [{ data: sortedDepts.map(d => d.rate), backgroundColor: '#3B82F6', borderRadius: 6, barThickness: 12, hoverBackgroundColor: '#1d4ed8' }] };
                chartOptions = { indexAxis: 'y', responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false }, tooltip: { callbacks: { label: (c) => c.raw.toFixed(1) + '%' } } }, scales: { x: { max: 100, display: false }, y: { ticks: { font: { size: 10, weight: 'bold' }, color: '#475569' }, grid: { display: false } } } };
            }
            learnerChart = new Chart(ctxL, { type: 'bar', data: chartData, options: chartOptions });
        }

        function renderDeptComparisonChart() {
            const ctxDC = document.getElementById('deptComparisonChart');
            if(deptComparisonChart) deptComparisonChart.destroy();
            const sortedDepts = getDeptStats().slice(0, 15);
            const chartData = {
                labels: sortedDepts.map(d => d.name.length > 30 ? d.name.substring(0,30) + '...' : d.name),
                datasets: [{
                    label: 'Completion Rate (%)',
                    data: sortedDepts.map(d => d.rate),
                    backgroundColor: sortedDepts.map(d => d.rate >= 80 ? '#10B981' : (d.rate >= 50 ? '#3B82F6' : '#F97316')),
                    borderRadius: 6,
                    barThickness: 18
                }]
            };
            const chartOptions = {
                indexAxis: 'y',
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false }, tooltip: { backgroundColor: 'rgba(15, 23, 42, 0.9)', titleColor: '#fff', bodyColor: '#cbd5e1', borderColor: '#334155', borderWidth: 1, padding: 10, callbacks: { label: (c) => `${c.raw.toFixed(1)}% (${sortedDepts[c.dataIndex].active}/${sortedDepts[c.dataIndex].total} members)` } } },
                scales: { x: { max: 100, beginAtZero: true, grid: { color: '#F1F5F9' }, ticks: { font: { size: 10 } } }, y: { grid: { display: false }, ticks: { font: { size: 10, weight: '600' }, color: '#334155' } } }
            };
            deptComparisonChart = new Chart(ctxDC, { type: 'bar', data: chartData, options: chartOptions });
        }
    </script>
</body>
</html>
